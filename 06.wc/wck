#!/usr/bin/env ruby
# frozen_string_literal: true

require 'optparse'
require 'debug' # debugger

def main
  options = ARGV.getopts('lwc')
  options = { 'l' => true, 'w' => true, 'c' => true } if options.values.none?

  if ARGV[0].nil?
    stdin_read = $stdin.read
    lines, words, sizes = conversion_values(options, stdin_read)

    puts stdin_form(lines, words, sizes)
  else
    paths = ARGV
    lines, words, sizes = conversion_values(options, paths)

    puts paths_form(lines, words, sizes)
    puts total(line: options['l'], word: options['w'], size: options['c']).compact.join(' ' * 4) if ARGV.length > 1
  end
end

def conversion_values(options, stdin_read_or_paths)
  lines = option_l(stdin_read_or_paths) if options['l']
  words = option_w(stdin_read_or_paths) if options['w']
  sizes = option_c(stdin_read_or_paths) if options['c']
  [lines, words, sizes]
end

def option_l(stdin_read_or_paths)
  ARGV[0].nil? ? stdin_read_or_paths.lines.count : stdin_read_or_paths.map { |path| File.read(path).lines.count }
end
# lines.countをまとめるためのアドバイスをいただきましたが、(45行目へ続く)
# def option_l(stdin_read_or_paths, line: false)
#   ARGV[0].nil? ? stdin_read_or_paths.lines.count : stdin_read_or_paths.map { |path| File.read(path).lines.count }
#   if line
#     if ARGV.nil?
#       aaa =
#     else
#       aaa =
#     end
#   end
#   aaa.lines.count 片方が文字列で片方が配列なので、どうしてもまとめ方がわかりません。
# end

def option_w(stdin_read_or_paths)
  ARGV[0].nil? ? stdin_read_or_paths.split(/\s+/).count : stdin_read_or_paths.map { |path| File.read(path).split(/\s+/).count }
end

def option_c(stdin_read_or_paths)
  ARGV[0].nil? ? stdin_read_or_paths.bytesize : stdin_read_or_paths.map { |path| File.read(path).bytesize }
end

def stdin_form(lines, words, sizes)
  [lines, words, sizes].compact.join(' ' * 4)
end

def paths_form(lines, words, sizes)
  transposed = [lines, words, sizes, ARGV].compact.transpose
  transposed.map do |row|
    row.join(' ' * 4)
  end
end

def total(line: false, word: false, size: false)
  line_total = ARGV.map { |path| File.read(path).lines.count }.sum if line
  word_total = ARGV.map { |path| File.read(path).split(/\s+/).count }.sum if word
  size_total = ARGV.map { |path| File.read(path).bytesize }.sum if size
  [line_total, word_total, size_total]
end

main
